(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{759:function(s,a,e){"use strict";e.r(a);var t=e(4),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"interpreter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#interpreter"}},[s._v("#")]),s._v(" interpreter")]),s._v(" "),e("blockquote",[e("p",[s._v("解释器文件是一种文本文件，"),e("code",[s._v("php")]),s._v("写的解释器文件")]),s._v(" "),e("p",[s._v("解释器文件也是可执行文件"),e("code",[s._v("ELF")])])]),s._v(" "),e("p",[s._v("一般格式为")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/php")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这一行为解释器所在的绝对路径。")]),s._v(" "),e("p",[e("code",[s._v("Linux")]),s._v("查看php所在的位置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("whereis")]),s._v(" php\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果写成上述加上解释器文件格式的在"),e("code",[s._v("Linux")]),s._v("中可以使用如下方式进行运行")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("php demo4.php\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("或者直接运行它本身，但是这里需要权限，我们可以查看文件的权限")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-4-centos process"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -al ./demo4.php")]),s._v("\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(" Apr  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20 ./demo4.php\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("这里没有可执行的权限，所以需要加上权限。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" who"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("u,g,o user,group,other"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 操作"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+,-,"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 权限"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("r 读, w 写, x 执行"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-4-centos process"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod u+x demo4.php")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-4-centos process"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -al ./demo4.php")]),s._v("\n-rwxr--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(" Apr  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":20 ./demo4.php\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-4-centos process"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./demo4.php")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("这种就可以不加"),e("code",[s._v("php")]),s._v("直接运行，这个就是解释器文件的编写和运行。")]),s._v(" "),e("h2",{attrs:{id:"bash进程启动的过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bash进程启动的过程"}},[s._v("#")]),s._v(" bash进程启动的过程")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("先输出当前进程号。")]),s._v(" "),e("ol",[e("li",[s._v("如果是直接在"),e("code",[s._v("centos")]),s._v("终端登录，就有"),e("code",[s._v("login")]),s._v("服务，它会去开启"),e("code",[s._v("bash")]),s._v("进程，这个我们不用管。")]),s._v(" "),e("li",[s._v("是通过网络方式登录到"),e("code",[s._v("shell")]),s._v("终端，它是有"),e("code",[s._v("sshd")]),s._v("服务去启动"),e("code",[s._v("bash")]),s._v("进程")])]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("sshd")]),s._v("服务监听的端口是22。")])]),s._v(" "),e("hr"),s._v(" "),e("h3",{attrs:{id:"进程观察的几个命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进程观察的几个命令"}},[s._v("#")]),s._v(" 进程观察的几个命令")]),s._v(" "),e("p",[e("code",[s._v("pstree")]),s._v("可以查看进程的一些关系：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("pstree -ap\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("1号进程是一个很特殊的进程，是杀不掉的，下面的都是它的子进程")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemd,1 --switched-root --system --deserialize "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("─sshd,1590 -D\n  │   ├─sshd,4315\n  │   │   └─bash,4317\n  │   │       └─pstree,12596 -ap\n  │   └─sshd,8087\n  │       └─sftp-server,8089\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("我们可以看到它下面的子进程有一个"),e("code",[s._v("bash")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-4-centos process"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo $$")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4317")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("我们可以看到当前进程就是"),e("code",[s._v("bash")]),s._v("的进程号")]),s._v(" "),e("p",[s._v("如果我们开启多个"),e("code",[s._v("ssh")]),s._v("客户端去连接，我们再次使用"),e("code",[s._v("pstree -ap")]),s._v("进行查看的时候，会再次开启一个"),e("code",[s._v("bash")]),s._v("进程。")]),s._v(" "),e("p",[s._v("如果在当前"),e("code",[s._v("bash")]),s._v("下，运行"),e("code",[s._v("php demo4.php")]),s._v("则在"),e("code",[s._v("bash")]),s._v("进程下又会有一个"),e("code",[s._v("php")]),s._v("执行的一个进程。")]),s._v(" "),e("p",[s._v("使用"),e("code",[s._v("strace")]),s._v("命令来跟踪调用")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("strace")]),s._v(" -f -s "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("65500")]),s._v(" -o ssh1.log -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1590")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("-f")]),s._v("：跟踪由"),e("code",[s._v("fork")]),s._v("调用所产生的子进程")]),s._v(" "),e("li",[e("code",[s._v("-s")]),s._v("：指定输出的字符串的最大长度，默认为32位")]),s._v(" "),e("li",[e("code",[s._v("-o")]),s._v("：将跟踪的信息输出到指定的文件")]),s._v(" "),e("li",[e("code",[s._v("-p")]),s._v("：跟踪的进程id")])]),s._v(" "),e("p",[s._v("输入完之后提示：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-4-centos process"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# strace -f -s 65500 -o ssh1.log -p 1590")]),s._v("\nstrace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1590")]),s._v(" attached\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("当我们重新打开一个连接：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("strace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1590")]),s._v(" attached\nstrace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24095")]),s._v(" attached\nstrace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24099")]),s._v(" attached\nstrace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24100")]),s._v(" attached\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("产生了很多进程。")]),s._v(" "),e("p",[s._v("我们在新的连接里不做过多的操作，操作显示一下当前内容："),e("code",[s._v("ls")]),s._v("即可，然后我们再把前面的跟踪的进程断掉【"),e("code",[s._v("ctrl + c")]),s._v("】，然后会提示：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("^Cstrace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1590")]),s._v(" detached\nstrace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24095")]),s._v(" detached\nstrace: Process "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24100")]),s._v(" detached\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("使用"),e("code",[s._v("ctrl + c")]),s._v("产生一个特殊字符，产生一个中断信号，就会退出进程。")]),s._v(" "),e("p",[s._v("然后看到目录下已经生成了一个"),e("code",[s._v("ssh1.log")]),s._v("这个文件，我们可以把它下载下来进行查看。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('select(19, [3 4], NULL, NULL, NULL) = 1 (in [3])\n# 第一步：接收 ssh 客户端连接\naccept(3, {sa_family=AF_INET, sin_port=htons(21831), sin_addr=inet_addr("客户端ip")}, [128->16]) = 5\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("select")]),s._v("：会监听文件描述符(fd)上的就绪事件，此处为19")]),s._v(" "),e("li",[e("code",[s._v("accept")]),s._v("：是用来接收一个客户端，返回一个客户端的链接的文件描述符，连接过来的客户端端口和ip地址")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 第二步：创建一个子进程\n<... clone resumed>child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7fcaa76f9b90) = 24095\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("24095：就是上述记录的一个进程号")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("clone")]),s._v("：相当于"),e("code",[s._v("fork")]),s._v("，就是用来创建一个子进程")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('execve("/usr/sbin/sshd", ["/usr/sbin/sshd", "-D", "-R"], 0x564f1fd38ab0 /* 4 vars */) = 0\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("execve")]),s._v("：执行一个程序 把当前进程的映像【正文段、数据段】用"),e("code",[s._v("sshd")]),s._v("程序来替换掉")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("socket(AF_NETLINK, SOCK_RAW, NETLINK_AUDIT) = 6\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("创建了一个"),e("code",[s._v("socket")]),s._v("套接字文，用于进程之间内部通信")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f152da53b90) = 24099\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("又继续创建了一个进程：24099")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f152da53b90) = 24100\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("继续创建一个进程：24100，这个过程会很多。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0x7f71c796fa10) = 24408\n\nexecve("/usr/bin/ls", ["ls", "--color=auto"], 0xc88dd0 /* 24 vars */) = 0\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("继续往下找，找到一个我们在另一个连接,创建一个新的"),e("code",[s._v("bash")]),s._v("进程，并且输入"),e("code",[s._v("ls")]),s._v("命令。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4021/20220402162847.png",alt:"sshd bash进程过程"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);