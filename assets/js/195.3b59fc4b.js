(window.webpackJsonp=window.webpackJsonp||[]).push([[195],{752:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"php解释器的工作大概流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#php解释器的工作大概流程"}},[s._v("#")]),s._v(" PHP解释器的工作大概流程")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("php demo1.php\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("前面说了，我们的"),a("code",[s._v("php")]),s._v("解释器文件是"),a("code",[s._v("ELF")]),s._v("可执行文件")]),s._v(" "),a("ol",[a("li",[s._v("Linux内核调用"),a("code",[s._v("execve")]),s._v("函数，会把"),a("code",[s._v("demo1.php")]),s._v("作为命令参数传入")]),s._v(" "),a("li",[s._v("使用解释器去读取脚本文件，脚本文件是"),a("code",[s._v("ascii text")]),s._v("文本文件")]),s._v(" "),a("li",[s._v("运行完之后就会调用"),a("code",[s._v("exit_group?(exit_status)")]),s._v("来进程终止状态")])]),s._v(" "),a("p",[s._v("可以使用"),a("code",[s._v("size")]),s._v("命令来查看"),a("code",[s._v("ELF")]),s._v("文件程序指令，程序数据所占空间的大小")]),s._v(" "),a("p",[s._v("可以使用"),a("code",[s._v("strace -f -s65500 php demo1.php")]),s._v("来查看执行的过程")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一行")]),s._v("\nexecve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/php"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"php"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo1.php"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", 0x7fffad2331e8 /* "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" vars */"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面加载了一些其他的第三方库")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面部分")]),s._v("\n\nopen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo1.php"')]),s._v(", O_RDONLY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\ngetcwd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/work/php/process"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\n\nmmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NULL, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(", PROT_READ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PROT_WRITE, MAP_PRIVATE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MAP_ANONYMOUS, -1, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0x7efc8f74e000\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解释运行")]),s._v("\nread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<?php'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("echo "),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("hello world"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(';"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("\nclose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc8f74e000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印内容 io 函数 没有缓冲区 向终端打印")]),s._v("\nwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v(", 11hello world"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出 关闭标准输入")]),s._v("\nclose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 共享内存的释放")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc80fb3000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2176600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc80d9a000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2196680")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc8f637000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192512")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc80b99000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2097248")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc82aa6000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4284872")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc82834000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2560784")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc823d1000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4596616")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc82184000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2410688")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc81e9b000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3050080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc81c97000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2109928")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc81a64000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2302680")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc81854000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2160296")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc81650000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2109720")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc81429000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2255216")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc811c7000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2494984")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc8f6b7000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("196608")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc89400000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2097152")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc8f596000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("659456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmunmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0x7efc8f710000, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135168")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出函数 退出状态码")]),s._v("\nexit_group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ?\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4021/20220331215143.png",alt:"PHP解释执行过程"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);