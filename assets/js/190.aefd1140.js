(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{748:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"mqtt"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt"}},[s._v("#")]),s._v(" MQTT")]),s._v(" "),t("h3",{attrs:{id:"禁用函数检查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#禁用函数检查"}},[s._v("#")]),s._v(" 禁用函数检查")]),s._v(" "),t("blockquote",[t("p",[s._v("使用这个脚本检查是否有禁用函数")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -Ss https://www.workerman.net/check "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用"),t("code",[s._v("workerman")]),s._v("需要解除一下函数的禁用")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("stream_socket_server\nstream_socket_client\npcntl_signal_dispatch\npcntl_signal\npcntl_alarm\npcntl_fork\nposix_getuid\nposix_getpwuid\nposix_kill\nposix_setsid\nposix_getpid\nposix_getpwnam\nposix_getgrnam\nposix_getgid\nposix_setgid\nposix_initgroups\nposix_setuid\nposix_isatty\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),t("p",[t("strong",[s._v("先杀掉之前的"),t("code",[s._v("mqtt.php")]),s._v("的进程")]),s._v("，现在因为是重新写了一个"),t("code",[s._v("mqtt_promote.php")])]),s._v(" "),t("h3",{attrs:{id:"每次代码更新-都得重新杀掉此进程-重新运行-因为workerman是常驻内存的。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#每次代码更新-都得重新杀掉此进程-重新运行-因为workerman是常驻内存的。"}},[s._v("#")]),s._v(" 每次代码更新，都得重新杀掉此进程，重新运行，因为"),t("code",[s._v("workerman")]),s._v("是常驻内存的。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" php\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-4-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef | grep php")]),s._v("\nroot     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24544")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16825")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":18 pts/0    00:00:00 WorkerMan: master process  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("start_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/work/php/process/mqtt_promote.php\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24544")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("执行脚本")]),s._v(" "),t("p",[t("code",[s._v("php")]),s._v("环境"),t("code",[s._v("ok")]),s._v("即可。不一定要7.4")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" /www/server/php/74/bin/php 文件所在目录/vinet-api.kssina.com/mqtt_promote.php start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /文件所在目录/vinet-api.kssina.com/data/mqtt.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4021/20220407144740.png",alt:"运行结果测试"}})]),s._v(" "),t("p",[s._v("以守护进程进行运行")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("/www/server/php/74/bin/php /data/work/php/process/mqtt_promote.php start -d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /data/work/php/process/mqtt.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);