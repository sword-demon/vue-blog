(window.webpackJsonp=window.webpackJsonp||[]).push([[222],{779:function(s,t,n){"use strict";n.r(t);var a=n(4),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"基于json的rpc库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于json的rpc库"}},[s._v("#")]),s._v(" 基于json的rpc库")]),s._v(" "),n("p",[s._v("很多"),n("code",[s._v("web")]),s._v("框架其自身都实现了"),n("code",[s._v("json-rpc")]),s._v("，但是我们要独立于这些框架之外，要寻求一种较为干净的解决方案，我们使用"),n("code",[s._v("jsonrpclib")]),s._v("。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/joshmarshall/jsonrpclib"}},[s._v("tcalmant/jsonrpclib")])]),s._v(" "),n("blockquote",[n("p",[s._v("这个库现在还在维护，同时支持"),n("code",[s._v("python2")]),s._v("和"),n("code",[s._v("python3")])])]),s._v(" "),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("pip "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" jsonrpclib-pelix -i https://pypi.douban.com/simple\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("服务端案例代码")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf8 -*-")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Time    : 2022/1/28 23:01")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author  : wxvirus")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @File    : server.py")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Software: PyCharm")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" jsonrpclib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SimpleJSONRPCServer "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" SimpleJSONRPCServer\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" b\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 实例化一个 server")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SimpleJSONRPCServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 将函数注册到 server 中")]),s._v("\nserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register_function"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 启动 server")]),s._v("\nserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serve_forever"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("客户端案例代码")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf8 -*-")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Time    : 2022/1/28 23:04")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author  : wxvirus")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @File    : client.py")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Software: PyCharm")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" jsonrpclib\n\nserver "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jsonrpclib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:8080'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("和"),n("code",[s._v("xmlrpc")]),s._v("底层不一样的就是序列化和反序列化为"),n("code",[s._v("json")]),s._v("格式，如果仅仅是专业，那几乎和"),n("code",[s._v("xmlrpc")]),s._v("没有优势可言，无非就是底层换掉了。")]),s._v(" "),n("p",[s._v("但是实际上，功能会比"),n("code",[s._v("xmlrpc")]),s._v("的功能要多一点，它还支持"),n("code",[s._v("SSL")]),s._v("和"),n("code",[s._v("Thread Pool")]),s._v("线程池，任何一个"),n("code",[s._v("web")]),s._v("服务如果不具备并发接收和处理的能力的话，那么这个"),n("code",[s._v("server")]),s._v("就没有用。")]),s._v(" "),n("h2",{attrs:{id:"rpc的一些功能需求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rpc的一些功能需求"}},[s._v("#")]),s._v(" rpc的一些功能需求")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("超长机制 - 重试")])]),s._v(" "),n("li",[n("p",[s._v("限流 - 处于长期可用的状态 - 高可用")])]),s._v(" "),n("li",[n("p",[s._v("解耦")])]),s._v(" "),n("li",[n("p",[s._v("负载均衡，一般是用在微服务，那就是分布式应用的具体体现，即需要多活策略")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("json")]),s._v("是否满足上述的要求")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("序列化数据压缩是否高效，"),n("code",[s._v("json")]),s._v("这种数据格式已经非常的简单了")])]),s._v(" "),n("li",[n("p",[s._v("能不能有一个算法或者协议，将这个数据压缩变得更小")])]),s._v(" "),n("li",[n("p",[s._v("这个序列化和反序列化的速度够不够快")]),s._v(" "),n("blockquote",[n("p",[s._v("在"),n("code",[s._v("python")]),s._v("中"),n("code",[s._v("json.dumps()")]),s._v("和"),n("code",[s._v("json.loads()")]),s._v("是非常耗时的。")])])])])])]),s._v(" "),n("p",[n("strong",[s._v("后面我们如果做架构，上述技术选型都是我们需要考虑到的点。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);