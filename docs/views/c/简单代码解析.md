---
title: 'C语言简单代码解析'
date: 2022-07-04 23:55:15
# 永久链接
permalink: '/c/analyse'
sidebar: 'auto'
isShowComment: true
categories:
 - c
tags:
 - null
---



## C语言简单代码解析

```c
#include <stdio.h>

int main()
{
    printf("hello world\r\n");
    return 0;
}
```

![图解](https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4021/无标题-2021-09-14-2036.excalidraw.png)



## gdb调试

加上调试选项

```bash
gcc demo1.c -o demo1 -g
```

可以使用`gcc -h`或者`man gcc`来查看如何使用。

证明它使用了调试信息：

```bash
[root@jb51 c]# file demo1
demo1: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, BuildID[sha1]=7603f8afb0d7daa9a7775274d97b19a830354a5d, not stripped
```



```bash
gdb -q ./demo1
```

常用命令：

-   start: 启动程序
-   next，缩写n：下一步，单步执行
-   step：下一步，缩写s，单步执行
-   display，x，print：打印值
-   quit：退出



>   在linux系统中，启动程序后，操作系统会给进程分配一个比较大的且连续的内存空间【地盘】
>
>   内存位置是以字节为单位衡量空间的大小的，同时进程的空间会划分为多个区域，每个区域都有不同的权限，并且每个区域上的权限也不同。

- 权限：可读、可写、可执行

-   变量的权限：默认都是可读可写

-   变量的本质：其实是内存地址的一个助记符号，其实是内存首地址的一个助记符号，`start address`，也可以说是基地址。



>   CPU执行程序的时候是逐条指令执行的【速度是非常之快的】



```bash
root@jb51 c]# gdb -q ./demo2
Reading symbols from /data/work/c/demo2...done.
(gdb) start
Temporary breakpoint 1 at 0x400535: file demo2.c, line 9.
Starting program: /data/work/c/./demo2 

Temporary breakpoint 1, main () at demo2.c:9
9               a = 0x11223344;
Missing separate debuginfos, use: debuginfo-install glibc-2.17-325.el7_9.x86_64
(gdb) p sizeof(int)
$1 = 4
(gdb) p &a
$2 = (int *) 0x7fffffffe45c
```

-   `0x7fffffffe45c`：这个是一个随机值，每次运行的时候，地址是会随机变化的，是随机分配的。

-   `p &a`：`print &a`：打印a的内存地址
-   `p a`：等价于`printf("%d\n", a)`，要从首地址开始取出数据且按4字节大小方式取出数据



那这样，它的地址后面的是连续的，后面的地址则不叫首地址了

-   首地址：`0x7fffffffe45c`

-   `0x7fffffffe45d`
-   `0x7fffffffe45e`
-   `0x7fffffffe45f`

```c
int a;
printf("%p\n", &a); // 打印变量a的地址，【进程的虚拟地址】
```



```bash
(gdb) display /4xb &a
1: x/4xb &a
0x7fffffffe45c: 0x00    0x00    0x00    0x00
```

打印变量`a`其余位置的地址



执行下一步，n: `next`

```bash
(gdb) n
11              printf("%d\n", a);
1: x/4xb &a
0x7fffffffe45c: 0x44    0x33    0x22    0x11
```



取数据

```bash
(gdb) p /x *((char*)(&a) + 1)
$8 = 0x33
```



二进制数值表示符号，例如：11001000

-   1：最高位，也称之为符号位，1：负数，0：正数
-   后面是数值位

如果是无符号的，8位都是数值。



>   数据类型只是影响数据的内存空间大小，特别注意就是有没有加上`unsigned`，区分有符号和无符号