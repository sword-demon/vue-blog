---
title: '授权、鉴权中心微服务'
date: 2022-01-20 22:34:15
# 永久链接
permalink: '/springcloud/privileges'
sidebar: 'auto'
isShowComment: true
categories:
 - springcloud
tags:
 - null
---



>   保持用户状态的技术叫做会话，也就是说用户不需要每次都输入账号和密码来说明身份。其中一种就是`session`，各种服务向持久层请求数据，优点是架构清晰，缺点是工作量比较大，如果持久层挂了就炸裂。另一种是服务器不保存`session`数据，每次请求都会发回到服务器，所有数据都保存在客户端，`jwt`就是一种方案的代表。



## JWT

>   JSON Web Token 是一个开放标准，它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。

:::tip 原理

服务器认证以后会生成一个JSON对象，发回给用户，以后用户和服务端通信的时候，都要携带这个数据，服务器完全靠这个对象去认证用户的身份，为了防止用户去随意的篡改数据，再生成对象的时候，也会进行签名，即进行加密，从而服务器变为无状态，比较容易实现扩展。

:::



场景：

-   用户授权
-   信息交换(少量)



### 组成部分

-   Header
-   Payload，负载，想要传递的数据
-   Singature(签名)

使用点号将这三个部分连接在一起：`xxxxx.yyyyy.zzzzz`



Header：由两部分(Token类型，加密算法名称)组成，并使用`Base64`编码

```json
{
    'alg': "HS256",
    'typ': "JWT"
}
```

-   alg：签名算法
-   type：令牌的类型，加密算法的类型



Playload：KV形式的数据，即想传递的数据(授权的话就是Token信息)



Signature：为了得到签名部分，你必须有编码过的 Header、编码过的 playload、一个秘钥，签名算法是Header中指定的那个，然后对它们签名即可。



```
HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(playload), secret)
```





## 逻辑流程图

<p align="center"><img src="https://gitee.com/wxvirus/img/raw/master/img/20220120225209.png" alt"逻辑" /></p>

